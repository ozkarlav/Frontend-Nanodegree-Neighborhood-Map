function tog(e){return e?"addClass":"removeClass"}var latitude=43.001044,longitude=-81.241073,map,pos,tempMarkers=[],jsonArray=[],marker,daysBack=[15,10,5,4,3,2,1],day=15,birdsData={myEagles:function(){jsonArray.push({birdID:1,birdName:"Bald Eagle",birdSights:2,birdLat:42.950497,birdLng:-81.40296,birdLocID:"L282714",birdLocName:"Komoka Park",birdLocPrivate:!1,birdObsDate:"2016-05-13 15:30",birdSciName:"Haliaeetus leucocephalus",marker:new google.maps.Marker({position:new google.maps.LatLng(42.950497,-81.40296),title:"Komoka Park",animation:google.maps.Animation.DROP,map:map,infowindow:new google.maps.InfoWindow({content:'<h3 id="infoTitle">My Bald Eagle Sightings</h3><strong>Observation Date: </strong>2016-05-13 15:30<br/><strong>Location: </strong>Komoka Park<br/><strong>Number of Eagles: </strong>2<br/><strong>Type of Property: </strong>Public<br/><a href="https://maps.google.com/?daddr=42.950497,-81.402960" target="_blank">Directions</a>'})})},{birdID:2,birdName:"Bald Eagle",birdSights:1,birdLat:42.971479,birdLng:-81.291974,birdLocID:"L282714",birdLocName:"Springbank Park",birdLocPrivate:!1,birdObsDate:"2016-06-16 14:30",birdSciName:"Haliaeetus leucocephalus",marker:new google.maps.Marker({position:new google.maps.LatLng(42.971479,-81.291974),title:"Springbank Park",animation:google.maps.Animation.DROP,map:map,infowindow:new google.maps.InfoWindow({content:'<h3 id="infoTitle">My Bald Eagle Sightings</h3><strong>Observation Date: </strong>2016-06-16 14:30<br/><strong>Location: </strong>Springbank Park<br/><strong>Number of Eagles: </strong>1<br/><strong>Type of Property: </strong>Public<br/><a href="https://maps.google.com/?daddr=42.971479,-81.291974" target="_blank">Directions</a>'})})},{birdID:3,birdName:"Bald Eagle",birdSights:1,birdLat:43.041009,birdLng:-81.184877,birdLocID:"L282714",birdLocName:"Fanshawe Park",birdLocPrivate:!1,birdObsDate:"2016-05-06 9:30",birdSciName:"Haliaeetus leucocephalus",marker:new google.maps.Marker({position:new google.maps.LatLng(43.041009,-81.184877),title:"Fanshawe Park",animation:google.maps.Animation.DROP,map:map,infowindow:new google.maps.InfoWindow({content:'<h3 id="infoTitle">My Bald Eagle Sightings</h3><strong>Observation Date: </strong>2016-05-06 9:30<br/><strong>Location: </strong>Fanshawe Park<br/><strong>Number of Eagles: </strong>1<br/><strong>Type of Property: </strong>Public<br/><a href="https://maps.google.com/?daddr=43.041009,-81.184877" target="_blank">Directions</a>'})})},{birdID:4,birdName:"Bald Eagle",birdSights:2,birdLat:43.012165,birdLng:-81.269242,birdLocID:"L282714",birdLocName:"Western University",birdLocPrivate:!1,birdObsDate:"2016-03-18 18:30",birdSciName:"Haliaeetus leucocephalus",marker:new google.maps.Marker({position:new google.maps.LatLng(43.012165,-81.269242),title:"Western University",animation:google.maps.Animation.DROP,map:map,infowindow:new google.maps.InfoWindow({content:'<h3 id="infoTitle">My Bald Eagle Sightings</h3><strong>Observation Date: </strong>2016-03-18 18:30<br/><strong>Location: </strong>Western University<br/><strong>Number of Eagles: </strong>2<br/><strong>Type of Property: </strong>Public<br/><a href="https://maps.google.com/?daddr=43.012165,-81.269242" target="_blank">Directions</a>'})})},{birdID:5,birdName:"Bald Eagle",birdSights:2,birdLat:42.945509,birdLng:-81.191275,birdLocID:"L282714",birdLocName:"Pond Mills",birdLocPrivate:!1,birdObsDate:"2016-02-18 11:30",birdSciName:"Haliaeetus leucocephalus",marker:new google.maps.Marker({position:new google.maps.LatLng(42.945509,-81.191275),title:"Pond Mills",animation:google.maps.Animation.DROP,map:map,infowindow:new google.maps.InfoWindow({content:'<h3 id="infoTitle">My Bald Eagle Sightings</h3><strong>Observation Date: </strong>2016-02-18 11:30<br/><strong>Location: </strong>Pond Mills<br/><strong>Number of Eagles: </strong>2<br/><strong>Type of Property: </strong>Public<br/><a href="https://maps.google.com/?daddr=42.945509,-81.191275" target="_blank">Directions</a>'})})}),viewModel.eBirdData(jsonArray),viewModel.listTitle("My Bald Eagle Sightings"),googleMap.mapMarkers(viewModel.eBirdData())},getData:function(){var e="http://ebird.org/ws1.1/data/obs/geo_spp/recent?lng="+longitude.toFixed(2)+"&lat="+latitude.toFixed(2)+"&sci=Haliaeetus%20leucocephalus&dist=50&back="+day+"&maxResults=25&locale=en_US&fmt=json&includeProvisional=true";$.getJSON(e,function(e){for(var o=e.length,a=0;o>a;a++){var r;r=e[a].locationPrivate===!0?"Private":"Public",jsonArray.push({birdID:a,birdLocName:e[a].locName.substring(0,35)+".",birdName:e[a].comName,birdSights:e[a].howMany,birdLat:e[a].lat,birdLng:e[a].lng,birdLocPrivate:r,birdLocID:e[a].locID,birdObsDate:e[a].obsDt,birdSciName:e[a].sciName,marker:new google.maps.Marker({position:new google.maps.LatLng(e[a].lat,e[a].lng),title:e[a].locName,animation:google.maps.Animation.DROP,map:map,infowindow:new google.maps.InfoWindow({content:'<h3 id="infoTitle">Bald Eagle Sightings</h3><strong>Observation Date: </strong>'+e[a].obsDt+"<br/><strong>Location: </strong>"+e[a].locName+"<br/><strong>Number of Eagles: </strong>"+e[a].howMany+"<br/><strong>Type of Property: </strong>"+r+'<br/><a href="https://maps.google.com/?daddr='+e[a].lat+","+e[a].lng+'" target="_blank">Directions</a>'})})})}viewModel.eBirdData(jsonArray),0===o?viewModel.dataInfo("Sorry, there are no Bald Eagles reports in this area. Try a different place or incrementing the number of days in your search"):viewModel.dataInfo(""),googleMap.mapMarkers(viewModel.eBirdData())}).error(function(){viewModel.dataInfo("Sorry, something went wrong with this search. Please try later")})}},viewModel={eBirdData:ko.observableArray([]),placeLoc:ko.observable("London, ON"),dataInfo:ko.observable(),query:ko.observable(""),days:ko.observableArray(daysBack),selectedDay:ko.observable(),listTitle:ko.observable(""),search:function(){day=viewModel.selectedDay();var e=new google.maps.Geocoder;googleMap.geocodeAddress(e,map)}};viewModel.searchLoc=ko.computed(function(){var e=viewModel.eBirdData(),o=viewModel.query().toLowerCase();return ko.utils.arrayFilter(e,function(e){return e.birdLocName.toLowerCase().indexOf(o)>=0})},viewModel);var googleMap={initMap:function(){map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:new google.maps.LatLng(latitude,longitude),panControl:!1,panControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.RIGHT_CENTER},scaleControl:!1}),birdsData.myEagles(),googleMap.mapMarkers(viewModel.eBirdData())},geocodeAddress:function(e,o){var a=document.getElementById("address").value;e.geocode({address:a},function(e,a){viewModel.eBirdData.removeAll(),googleMap.clearMarkers(),googleMap.mapMarkers(viewModel.eBirdData()),a===google.maps.GeocoderStatus.OK?(pos=e[0].geometry.location,o.setCenter(pos),latitude=e[0].geometry.location.lat(),longitude=e[0].geometry.location.lng(),googleMap.mapMarkers(viewModel.eBirdData()),viewModel.listTitle("Search results..."),birdsData.getData()):alert("Geocode was not successful for the following reason: "+a)})},mapMarkers:function(e){$.each(e,function(e,o){var a=(o.birdLat,o.birdLng,o.birdID,o.birdName,o.birdObsDate,o.birdLocName,o.marker);tempMarkers.push(a),google.maps.event.addListener(a,"click",function(){a.infowindow.open(map,a)}),google.maps.event.addListener(map,"click",function(){a.infowindow.close()})});for(var o=new google.maps.LatLngBounds,a=0;a<tempMarkers.length;a++)o.extend(tempMarkers[a].getPosition()),map.fitBounds(o)},clearMarkers:function(){for(var e=0;e<tempMarkers.length;e++)tempMarkers[e].setMap(null);tempMarkers.length=0}};viewModel.listViewClick=function(e){e.birdLocName&&(marker=this.marker,marker.infowindow.open(map,marker),map.setZoom(14),map.setCenter(marker.getPosition()))},viewModel.mouseOver=function(e){e.birdLocName&&(marker=this.marker,marker.setAnimation(google.maps.Animation.BOUNCE))},viewModel.ko.applyBindings(viewModel),googleMap.initMap(),$(document).on("input",".clearable",function(){$(this)[tog(this.value)]("x")}).on("mousemove",".x",function(e){$(this)[tog(this.offsetWidth-18<e.clientX-this.getBoundingClientRect().left)]("onX")}).on("touchstart click",".onX",function(e){e.preventDefault(),$(this).removeClass("x onX").val("").change()}),$(".clearable").trigger("input");