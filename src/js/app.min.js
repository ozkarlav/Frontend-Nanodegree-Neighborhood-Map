var latitude=43.001044,longitude=-81.241073,map,pos,tempMarkers=[],jsonArray=[],iconImg="images/eagle",marker,infowindow,daysBack=[15,10,5,4,3,2,1],day=15,birdsData={myEagles:function(){jsonArray.push({birdID:1,birdName:"Bald Eagle",birdSights:2,birdLat:42.950497,birdLng:-81.40296,birdLocID:"L282714",birdLocName:"Komoka Park",birdLocPrivate:!1,birdObsDate:"2016-05-13 15:30",birdSciName:"Haliaeetus leucocephalus",marker:new google.maps.Marker({position:new google.maps.LatLng(42.950497,(-81.40296)),title:"Komoka Park",icon:iconImg+"Default.png",animation:google.maps.Animation.DROP,map:map,content:'<h3 id="infoTitle">My Bald Eagle Sightings</h3><strong>Observation Date: </strong>2016-05-13 15:30<br/><strong>Location: </strong>Komoka Park<br/><strong>Number of Eagles: </strong>2<br/><strong>Type of Property: </strong>Public<br/><a href="https://maps.google.com/?daddr=42.950497,-81.402960" target="_blank">Directions</a>'})},{birdID:2,birdName:"Bald Eagle",birdSights:1,birdLat:42.971479,birdLng:-81.291974,birdLocID:"L282714",birdLocName:"Springbank Park",birdLocPrivate:!1,birdObsDate:"2016-06-16 14:30",birdSciName:"Haliaeetus leucocephalus",marker:new google.maps.Marker({position:new google.maps.LatLng(42.971479,(-81.291974)),title:"Springbank Park",icon:iconImg+"Default.png",animation:google.maps.Animation.DROP,map:map,content:'<h3 id="infoTitle">My Bald Eagle Sightings</h3><strong>Observation Date: </strong>2016-06-16 14:30<br/><strong>Location: </strong>Springbank Park<br/><strong>Number of Eagles: </strong>1<br/><strong>Type of Property: </strong>Public<br/><a href="https://maps.google.com/?daddr=42.971479,-81.291974" target="_blank">Directions</a>'})},{birdID:3,birdName:"Bald Eagle",birdSights:1,birdLat:43.041009,birdLng:-81.184877,birdLocID:"L282714",birdLocName:"Fanshawe Park",birdLocPrivate:!1,birdObsDate:"2016-05-06 9:30",birdSciName:"Haliaeetus leucocephalus",marker:new google.maps.Marker({position:new google.maps.LatLng(43.041009,(-81.184877)),title:"Fanshawe Park",icon:iconImg+"Default.png",animation:google.maps.Animation.DROP,map:map,content:'<h3 id="infoTitle">My Bald Eagle Sightings</h3><strong>Observation Date: </strong>2016-05-06 9:30<br/><strong>Location: </strong>Fanshawe Park<br/><strong>Number of Eagles: </strong>1<br/><strong>Type of Property: </strong>Public<br/><a href="https://maps.google.com/?daddr=43.041009,-81.184877" target="_blank">Directions</a>'})},{birdID:4,birdName:"Bald Eagle",birdSights:2,birdLat:43.012165,birdLng:-81.269242,birdLocID:"L282714",birdLocName:"Western University",birdLocPrivate:!1,birdObsDate:"2016-03-18 18:30",birdSciName:"Haliaeetus leucocephalus",marker:new google.maps.Marker({position:new google.maps.LatLng(43.012165,(-81.269242)),title:"Western University",icon:iconImg+"Default.png",animation:google.maps.Animation.DROP,map:map,content:'<h3 id="infoTitle">My Bald Eagle Sightings</h3><strong>Observation Date: </strong>2016-03-18 18:30<br/><strong>Location: </strong>Western University<br/><strong>Number of Eagles: </strong>2<br/><strong>Type of Property: </strong>Public<br/><a href="https://maps.google.com/?daddr=43.012165,-81.269242" target="_blank">Directions</a>'})},{birdID:5,birdName:"Bald Eagle",birdSights:2,birdLat:42.945509,birdLng:-81.191275,birdLocID:"L282714",birdLocName:"Pond Mills",birdLocPrivate:!1,birdObsDate:"2016-02-18 11:30",birdSciName:"Haliaeetus leucocephalus",marker:new google.maps.Marker({position:new google.maps.LatLng(42.945509,(-81.191275)),title:"Pond Mills",icon:iconImg+"Default.png",animation:google.maps.Animation.DROP,map:map,content:'<h3 id="infoTitle">My Bald Eagle Sightings</h3><strong>Observation Date: </strong>2016-02-18 11:30<br/><strong>Location: </strong>Pond Mills<br/><strong>Number of Eagles: </strong>2<br/><strong>Type of Property: </strong>Public<br/><a href="https://maps.google.com/?daddr=42.945509,-81.191275" target="_blank">Directions</a>'})}),viewModel.eBirdData(jsonArray),viewModel.listTitle("My Bald Eagle Sightings"),googleMap.mapMarkers(viewModel.eBirdData())},getData:function(){var a="http://ebird.org/ws1.1/data/obs/geo_spp/recent?lng="+longitude.toFixed(2)+"&lat="+latitude.toFixed(2)+"&sci=Haliaeetus%20leucocephalus&dist=50&back="+day+"&maxResults=25&locale=en_US&fmt=json&includeProvisional=true";$.getJSON(a).done(function(a){for(var b=a.length,c=0;c<b;c++){var d;d=a[c].locationPrivate===!0?"Private":"Public",jsonArray.push({birdID:c,birdLocName:a[c].locName.substring(0,35)||"Location Unknown",birdName:a[c].comName||"Name Unknown",birdSights:a[c].howMany||"Number Unknown",birdLat:a[c].lat,birdLng:a[c].lng,birdLocPrivate:d,birdLocID:a[c].locID||"Location ID Unknown",birdObsDate:a[c].obsDt||"Observation Date Unknown",birdSciName:a[c].sciName||"Scientific Name Unknown",marker:new google.maps.Marker({position:new google.maps.LatLng(a[c].lat,a[c].lng),title:a[c].locName,icon:iconImg+"Default.png",animation:google.maps.Animation.DROP,map:map,content:'<h3 id="infoTitle">Bald Eagle Sightings</h3><strong>Observation Date: </strong>'+a[c].obsDt+"<br/><strong>Location: </strong>"+a[c].locName+"<br/><strong>Number of Eagles: </strong>"+a[c].howMany+"<br/><strong>Type of Property: </strong>"+d+'<br/><a href="https://maps.google.com/?daddr='+a[c].lat+","+a[c].lng+'" target="_blank">Directions</a>'})})}viewModel.eBirdData(jsonArray),0===b?viewModel.dataInfo("Sorry, there are no Bald Eagles reports in this area. Try a different place or incrementing the number of days in your search"):viewModel.dataInfo(""),googleMap.mapMarkers(viewModel.eBirdData())}).fail(function(){viewModel.dataInfo("Sorry, something went wrong with this search. Please try later")})}},viewModel={eBirdData:ko.observableArray([]),placeLoc:ko.observable("London, ON"),dataInfo:ko.observable(),query:ko.observable(""),days:ko.observableArray(daysBack),selectedDay:ko.observable(),listTitle:ko.observable(""),showWrapper:ko.observable(!1),search:function(){day=viewModel.selectedDay();var a=new google.maps.Geocoder;googleMap.geocodeAddress(a,map)}};viewModel.searchLoc=ko.computed(function(){var a=viewModel.eBirdData(),b=viewModel.query().toLowerCase();return ko.utils.arrayFilter(a,function(a){if(a.marker.setVisible(!1),a.birdLocName.toLowerCase().indexOf(b)>=0)return a.marker.setVisible(!0),a.birdLocName.toLowerCase().indexOf(b)>=0})},viewModel);var googleMap={initMap:function(){map=new google.maps.Map(document.getElementById("map"),{zoom:10,center:new google.maps.LatLng(latitude,longitude),panControl:!1,panControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.RIGHT_CENTER},scaleControl:!1}),infowindow=new google.maps.InfoWindow,birdsData.myEagles(),googleMap.mapMarkers(viewModel.eBirdData())},geocodeAddress:function(a,b){var c=document.getElementById("address").value;a.geocode({address:c},function(a,c){viewModel.query(""),viewModel.eBirdData.removeAll(),googleMap.clearMarkers(),googleMap.mapMarkers(viewModel.eBirdData()),c===google.maps.GeocoderStatus.OK?(pos=a[0].geometry.location,b.setCenter(pos),latitude=a[0].geometry.location.lat(),longitude=a[0].geometry.location.lng(),googleMap.mapMarkers(viewModel.eBirdData()),viewModel.listTitle("Search results..."),birdsData.getData()):alert("Geocode was not successful for the following reason: "+c)})},mapMarkers:function(a){var b=new google.maps.LatLngBounds;$.each(a,function(a,c){var d=(c.birdLat,c.birdLng,c.birdID,c.birdName,c.birdObsDate,c.birdLocName,c.marker);tempMarkers.push(d),b.extend(d.getPosition()),google.maps.event.addListener(d,"click",function(){d.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){d.setAnimation(null)},2e3),infowindow.setContent(d.content),infowindow.open(map,d)}),google.maps.event.addListener(infowindow,"closeclick",function(){map.fitBounds(b)}),google.maps.event.addListener(map,"click",function(){d.infowindow.close()})}),map.fitBounds(b)},clearMarkers:function(){for(;tempMarkers.length;)tempMarkers[0].setMap(null),tempMarkers.shift()}};viewModel.toggleWrapper=function(){viewModel.showWrapper()?viewModel.showWrapper(!1):viewModel.showWrapper(!0)},viewModel.listViewClick=function(a){a.birdLocName&&(marker=this.marker,infowindow.setContent(marker.content),infowindow.open(map,marker),map.setZoom(12),map.setCenter(marker.getPosition()))},viewModel.mouseOver=function(a){a.birdLocName&&(marker=this.marker,marker.setAnimation(google.maps.Animation.BOUNCE),marker.setIcon(iconImg+"Selected.png"))},viewModel.mouseOut=function(a){a.birdLocName&&(marker=this.marker,marker.setAnimation(null),marker.setIcon(iconImg+"Default.png"))};